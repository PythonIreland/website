image: python.ie/website-dev
tasks:
  deps:compute:
    description: Compute the dependencies
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m uv pip compile --output-file requirements/main.txt requirements/main.in
      python -m uv pip compile --output-file requirements/dev.txt requirements/dev.in
      python -m uv pip compile --output-file requirements/production.txt requirements/production.in

  deps:outdated:
    description: Show the outdated dependencies
    cache: false
    command: python -m pip list -o

  deps:upgrade:
    description: Upgrade the dependencies
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m uv pip compile --upgrade --output-file requirements/main.txt requirements/main.in
      python -m uv pip compile --upgrade --output-file requirements/dev.txt requirements/dev.in
      python -m uv pip compile --upgrade --output-file requirements/production.txt requirements/production.in

  deps:upgrade:django:
    description: Upgrade Django to the latest compatible version
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m uv pip compile --upgrade-package django --output-file requirements/main.txt requirements/main.in
      python -m uv pip compile --upgrade-package django --output-file requirements/dev.txt requirements/dev.in
      python -m uv pip compile --upgrade-package django --output-file requirements/production.txt requirements/production.in

  deps:upgrade:wagtail:
    description: Upgrade Wagtail to the latest compatible version
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m uv pip compile --upgrade-package wagtail --output-file requirements/main.txt requirements/main.in
      python -m uv pip compile --upgrade-package wagtail --output-file requirements/dev.txt requirements/dev.in
      python -m uv pip compile --upgrade-package wagtail --output-file requirements/production.txt requirements/production.in

  deps:security:
    description: Check dependencies for known security vulnerabilities
    cache: false
    command: pip-audit

  deps:tree:
    description: Show the dependencies tree
    cache: false
    command: pipdeptree

  code:format:
    description: Format the code
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m ruff format pythonie

  code:lint:
    description: Lint the code and fix issues
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m ruff check --fix pythonie

  code:check:
    description: Check code formatting and linting without changes
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m ruff format --check pythonie
      python -m ruff check pythonie

  fish:
    description: Run a shell
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: /usr/bin/fish
