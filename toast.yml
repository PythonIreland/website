image: python.ie/website-dev
tasks:
  deps:lock:
    description: Update uv.lock file from pyproject.toml
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: uv lock

  deps:upgrade:
    description: Upgrade all dependencies
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: uv lock --upgrade

  deps:sync:
    description: Install dependencies from lock file
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: uv sync

  deps:export:
    description: Export uv.lock to requirements.txt for Heroku
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      uv export --no-dev --group production -o requirements.txt
      echo "# AUTO-GENERATED from pyproject.toml - DO NOT EDIT" | cat - requirements.txt > temp && mv temp requirements.txt

  deps:outdated:
    description: Show the outdated dependencies
    cache: false
    command: python -m pip list -o

  deps:security:
    description: Check dependencies for known security vulnerabilities
    cache: false
    command: uv run pip-audit

  deps:tree:
    description: Show the dependencies tree
    cache: false
    command: uv tree

  code:format:
    description: Format the code
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m ruff format pythonie

  code:lint:
    description: Lint the code and fix issues
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m ruff check --fix pythonie

  code:check:
    description: Check code formatting and linting without changes
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: |
      python -m ruff format --check pythonie
      python -m ruff check pythonie

  fish:
    description: Run a shell
    cache: false
    mount_paths:
      - .:/app
    location: /app
    command: /usr/bin/fish
